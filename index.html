<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Love Like DataBase</title>
    <meta name="theme-color" content="#E63946">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0D09G3X4F1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-0D09G3X4F1');
    </script>

    <!-- ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š -->
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="manifest" href='data:application/manifest+json,{"name":"Love Like DataBase","short_name":"LLDB","start_url":".","display":"standalone","background_color":"#F8F8F8","theme_color":"#ef4444","icons":[{"src":"./icon.png","sizes":"192x192 512x512","type":"image/png"}]}'>

    <!-- å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (å…±é€š) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        /* ==========================================================================
           ã€0. GLOBALã€‘ ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«
           ========================================================================== */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #F8F9FA; /* Off-White for Hub */
            color: #334155;
            overflow: hidden;
            touch-action: pan-y pinch-zoom;
            -webkit-tap-highlight-color: transparent;
        }
        /* ã‚¢ãƒ—ãƒªç”»é¢ã‚³ãƒ³ãƒ†ãƒŠå®šç¾© */
        .app-screen {
            position: fixed; top: 60px; left: 0; width: 100%; height: calc(100% - 60px);
            display: none; flex-direction: column;
            overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch;
            background-color: #F8F9FA; animation: fadeIn 0.3s ease-out;
        }
        .app-screen.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    </style>

    <script>
        // ==========================================================================
        // ã€0. GLOBALã€‘ å…±é€šå®šæ•°è¨­å®š
        // ==========================================================================
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbzy7CNn83anQMEsvNxyK3zHMtTRtjHk6XZ-jWBNllRNxcXv41hKw-TenGoGjfpps6rLUw/exec";
        const ICON_URL = "https://unavatar.io/twitter/noki_dochibi";
        const APP_VERSION = "v4.3.0"; /* Major Update for Renewal */
    </script>
</head>
<body class="bg-gray-50">

    <!-- ==========================================================================
           ã€1. COMMON UIã€‘ ãƒ˜ãƒƒãƒ€ãƒ¼ & æš–ç°¾ãƒ¡ãƒ‹ãƒ¥ãƒ¼
           ========================================================================== -->
    <style>
        /* æš–ç°¾ãƒ¡ãƒ‹ãƒ¥ãƒ¼ & ãƒ˜ãƒƒãƒ€ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #noren-menu {
            position: fixed; top: 60px; left: 0; width: 100%;
            max-height: calc(100vh - 80px); /* ç”»é¢ä¸‹ç«¯ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹ */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* iOSã§ã®æ…£æ€§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */

            background-color: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1); z-index: 50;
            transform: translateY(-120%); 
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            border-bottom-left-radius: 24px; border-bottom-right-radius: 24px; border-bottom: 1px solid #f1f5f9;
            display: block; visibility: hidden;
        }
        #noren-menu.open { transform: translateY(0); visibility: visible; }
        
        .noren-item { display: flex; align-items: center; gap: 14px; padding: 18px 24px; border-bottom: 1px solid #f1f5f9; cursor: pointer; transition: background-color 0.2s; }
        .noren-item:active { background-color: #f8fafc; }
        .noren-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 22px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
        
        #noren-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 40; display: none; opacity: 0; transition: opacity 0.3s; }
        #noren-overlay.open { display: block; opacity: 1; }

        #main-app-header {
            height: 60px; width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 16px;
            position: fixed; top: 0; z-index: 60;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s;
            /* ã‚¿ãƒƒãƒ—å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºå”† */
            cursor: pointer; 
        }

        .flower-icon {
            font-size: 24px;
            display: inline-block;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .flower-icon.rotate { transform: rotate(180deg) scale(1.1); }

        #about-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); opacity: 0; transition: opacity 0.3s; }
        #about-modal.open { display: flex; opacity: 1; }
        .modal-card { background: white; width: 90%; max-width: 400px; border-radius: 24px; padding: 28px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); transform: scale(0.95); transition: transform 0.3s; }
        #about-modal.open .modal-card { transform: scale(1); }
    </style>

    <!-- æš–ç°¾ãƒ¡ãƒ‹ãƒ¥ãƒ¼HTML -->
    <div id="noren-overlay" onclick="toggleNoren()"></div>
    <div id="noren-menu">
        <div class="flex flex-col">
            <!-- 1. LLDB Live (#E63946) -->
            <div class="noren-item" onclick="switchApp('live')">
                <div class="noren-icon bg-[#E63946]"><i data-lucide="mic-2" class="w-6 h-6"></i></div>
                <div class="flex-1">
                    <div class="font-bold text-gray-800 text-lg">LLDB Live</div>
                    <div class="text-xs text-gray-400 mt-0.5">ã‚»ãƒˆãƒª / æ¼”å¥å›æ•° / å‚¾å‘</div>
                </div>
                <i data-lucide="chevron-right" class="text-gray-300 w-5 h-5"></i>
            </div>

            <!-- 2. LLDB Trends (#1D3557) -->
            <div class="noren-item" onclick="switchApp('trends')">
                <div class="noren-icon bg-[#1D3557]"><i data-lucide="trending-up" class="w-6 h-6"></i></div>
                <div class="flex-1">
                    <div class="font-bold text-gray-800 text-lg">LLDB Trends</div>
                    <div class="text-xs text-gray-400 mt-0.5">Youtubeå†ç”Ÿæ•° / SNSãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼è¨˜éŒ²</div>
                </div>
                <i data-lucide="chevron-right" class="text-gray-300 w-5 h-5"></i>
            </div>

            <!-- 3. LLDB Song Helper (#F4A261) -->
            <div class="noren-item" onclick="switchApp('songHelper')">
                <div class="noren-icon bg-[#F4A261]"><i data-lucide="music" class="w-6 h-6"></i></div>
                <div class="flex-1">
                    <div class="font-bold text-gray-800 text-lg">LLDB Song Helper</div>
                    <div class="text-xs text-gray-400 mt-0.5">ãƒ•ãƒ¬ãƒ¼ã‚º/æ¥½æ›²æ¤œç´¢</div>
                </div>
                <i data-lucide="chevron-right" class="text-gray-300 w-5 h-5"></i>
            </div>

            <!-- 4. LLDB History (#2A9D8F) -->
            <div class="noren-item" onclick="switchApp('history')">
                <div class="noren-icon bg-[#2A9D8F]"><i data-lucide="heart-handshake" class="w-6 h-6"></i></div>
                <div class="flex-1">
                    <div class="font-bold text-gray-800 text-lg">LLDB History</div>
                    <div class="text-xs text-gray-400 mt-0.5">ã‚ãŸã—ã¨aikoã®äººç”Ÿå¹´è¡¨</div>
                </div>
                <i data-lucide="chevron-right" class="text-gray-300 w-5 h-5"></i>
            </div>
 
        <!-- â˜…è¿½åŠ æ©Ÿèƒ½: ã‚»ãƒˆãƒªæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="noren-item bg-gray-50/50" onclick="openSetlistForm()">
            <div class="noren-icon bg-blue-500"><i data-lucide="send" class="w-6 h-6"></i></div>
            <div class="flex-1">
                <div class="font-bold text-gray-600 text-lg">ã‚»ãƒˆãƒªæŠ•ç¨¿</div>
                <div class="text-xs text-gray-400 mt-0.5">ã‚»ãƒˆãƒªã®æƒ…å ±æä¾›ã®å”åŠ›ï¼ˆé æ…®ã›ãšï¼ï¼‰</div>
            </div>
            <i data-lucide="chevron-right" class="text-gray-300 w-5 h-5"></i>
        </div>
           
            <!-- About Menu -->
            <div class="noren-item bg-gray-50/50" onclick="openAboutModal()">
                <div class="noren-icon bg-gray-400"><i data-lucide="info" class="w-6 h-6"></i></div>
                <div class="flex-1">
                <div class="font-bold text-gray-600 text-lg">ã“ã®ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦</div>
              <div class="text-xs text-gray-400 mt-0.5">ã‚¢ãƒ—ãƒªã®èª¬æ˜ / é–‹ç™ºè€…æƒ…å ±</div>
            </div>
            <i data-lucide="chevron-right" class="text-gray-300 w-5 h-5"></i>
          </div>
    
    <div class="noren-item bg-gray-50/50" onclick="forceReloadApp()">
            <div class="noren-icon bg-gray-600"><i data-lucide="refresh-cw" class="w-6 h-6"></i></div>
            <div class="flex-1">
              <div class="font-bold text-gray-600 text-lg">æœ€æ–°ç‰ˆã‚’èª­ã¿è¾¼ã¿</div>
              <div class="text-xs text-gray-400 mt-0.5">å¼·åˆ¶å†èµ·å‹•ï¼ˆæŒ™å‹•ãŒå¤‰ãªã¨ãï¼‰</div>
            </div>
            <i data-lucide="chevron-right" class="text-gray-300 w-5 h-5"></i>
          </div>
    </div>

    <div class="py-4 flex justify-center cursor-pointer hover:bg-gray-50 active:bg-gray-100 transition rounded-b-[24px]" onclick="toggleNoren()">
      <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
    </div>
  </div>

    <!-- å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header id="main-app-header" class="bg-[#E63946] text-white transition-colors duration-300">
        <!-- Live App Header as Default -->
        <h1 class="font-black text-[22px] tracking-wide flex-1 truncate pr-2" id="header-title">Love Like DataBase vol.4.1</h1>
        
        <!-- ğŸŒ¸ Menu Button -->
        <button id="header-menu-btn" onclick="toggleNoren()" class="p-2 rounded-full hover:bg-white/20 transition active:scale-90 flex items-center justify-center w-10 h-10">
            <span class="flower-icon select-none">ğŸŒ¸</span>
        </button>
    </header>

    <!-- About Modal -->
    <div id="about-modal" onclick="closeAboutModal()">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="text-center mb-6">
                <h2 class="font-bold text-xl text-gray-800">Love Like DataBase</h2>
                <p id="about-version-display" class="text-xs text-gray-400 font-mono mt-1"></p>
            </div>
            
            <div class="space-y-4 text-sm text-gray-600 leading-relaxed overflow-y-auto max-h-[50vh]">
                <p>ã“ã®ã‚¢ãƒ—ãƒªã¯ã€å€‹äººé–‹ç™ºè€…ãŒè¶£å‘³ã§ä½œã£ãŸã€éå…¬å¼ã®ãƒ•ã‚¡ãƒ³ã‚¢ãƒ—ãƒªã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã®èª¤ã‚Šã‚’å«ã‚“ã§ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
                <p>ä¸å…·åˆå ±å‘Šã‚„ã€ã€Œã“ã“é–“é•ã£ã¦ã‚‹ã‚ˆï¼ã€ã¨ã„ã†ã”æŒ‡æ‘˜ã¯ã€X (æ—§Twitter) ã¾ã§ãŠå¯„ã›ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚</p>
            </div>

            <div class="mt-8 flex justify-center">
                <a href="https://twitter.com/noki_dochibi" target="_blank" class="flex items-center gap-2 px-5 py-2.5 bg-black text-white rounded-full text-xs font-bold hover:bg-gray-800 transition shadow-lg active:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 fill-current" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    é–‹ç™ºè€… @noki_dochibi
                </a>
            </div>
            
            <!-- â˜…è¿½åŠ : æ›´æ–°å±¥æ­´ã‚¨ãƒªã‚¢ -->
            <div class="history-list">
                <div class="flex items-center gap-2 mb-3">
                    <i data-lucide="history" class="w-4 h-4 text-gray-400"></i>
                    <h3 class="font-bold text-gray-600 text-xs">æ›´æ–°å±¥æ­´</h3>
                </div>
                <div id="update-history-content" class="max-h-[150px] overflow-y-auto no-scrollbar">
                    <div class="text-center py-4 text-gray-400 text-xs animate-pulse">èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>

            <div class="mt-6 pt-4 border-t border-gray-100 text-center">
                 <button onclick="closeAboutModal()" class="text-gray-400 text-sm font-bold hover:text-gray-600 px-4 py-2">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>


    <!-- ==========================================================================
           ã€2. APP: LLDB Liveã€‘ 
           ========================================================================== -->
    <div id="app-live" class="app-screen active">
        <!-- Liveã‚¢ãƒ—ãƒªã¯ç‹¬è‡ªã®UI/UXã‚’æŒã¤ãŸã‚å…¨ç”»é¢è¡¨ç¤º -->
        <iframe src="./index_LLDBLive.html" class="w-full h-full border-none"></iframe>
    </div>

    <!-- ==========================================================================
           ã€3. APP: LLDB Trendsã€‘
           ========================================================================== -->
    <div id="app-trends" class="app-screen">
        <iframe src="./index_LLDBTrends.html" class="w-full h-full border-none"></iframe>
    </div>

    <!-- ==========================================================================
           ã€4. APP: LLDB Song Helperã€‘
           ========================================================================== -->
    <div id="app-songHelper" class="app-screen">
        <iframe src="./index_LLDBSongHelper.html" class="w-full h-full border-none"></iframe>
    </div>

    <!-- ==========================================================================
           ã€5. APP: LLDB Historyã€‘
           ========================================================================== -->
    <div id="app-history" class="app-screen">
        <iframe src="./index_LLDBHistory.html" class="w-full h-full border-none"></iframe>
    </div>


    <!-- ==========================================================================
           ã€6. ROUTINGã€‘ å…±é€šãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åˆ¶å¾¡
           ========================================================================== -->
    <script>
        // â–¼ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ–‡å­—åˆ—ã®æ•´å½¢ãƒ­ã‚¸ãƒƒã‚¯ (New) â–¼
        // 1. "vX.X.X" ã‹ã‚‰ "X.X.X" ã‚’æŠ½å‡º
        const versionNum = APP_VERSION.replace('v', '');
        const versionParts = versionNum.split('.');
        
        // 2. ãƒ˜ãƒƒãƒ€ãƒ¼ç”¨: 2æ¡è¡¨ç¤º & vol. è¡¨è¨˜ (ä¾‹: vol.4.2)
        const headerVersion = `vol.${versionParts[0]}.${versionParts[1]}`;

        // 3. Aboutç”¨: 3æ¡è¡¨ç¤º & vol. è¡¨è¨˜ (ä¾‹: vol.4.2.1)
        const aboutVersion = `vol.${versionNum}`;


        // ã‚¢ãƒ—ãƒªå®šç¾© (ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°)
        const apps = {
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«ã«ã¯2æ¡ã® headerVersion ã‚’ä½¿ç”¨
            'live': { title: `Love Like DataBase ${headerVersion}`, color: 'bg-[#E63946]' }, /* Red */
            'trends': { title: 'LLDB Trends', color: 'bg-[#1D3557]' },       /* Navy */
            'songHelper': { title: 'LLDB Song Helper', color: 'bg-[#F4A261]' }, /* Orange */
            'history': { title: 'LLDB History', color: 'bg-[#2A9D8F]' }       /* Teal */
        };

        // ã‚¢ãƒ—ãƒªåˆ‡ã‚Šæ›¿ãˆ
        function switchApp(appName) {
            document.querySelectorAll('.app-screen').forEach(el => el.classList.remove('active'));
            const target = document.getElementById('app-' + appName);
            if(target) target.classList.add('active');

            // ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
            const header = document.getElementById('main-app-header');
            const title = document.getElementById('header-title');
            if(apps[appName]) {
                // Tailwindã®JITã‚«ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹(bg-[#...])ã‚’å‹•çš„ã«é©ç”¨ã™ã‚‹ãŸã‚ã€styleå±æ€§ã§ã¯ãªãclassNameã‚’æ›´æ–°
                header.className = `${apps[appName].color} text-white transition-colors duration-300 flex items-center justify-between px-4 fixed top-0 z-30 shadow-sm w-full h-[60px]`;
                title.textContent = apps[appName].title;
            }

            // æš–ç°¾ã‚’é–‰ã˜ã‚‹
            const menu = document.getElementById('noren-menu');
            if(menu.classList.contains('open')) toggleNoren();
            
            lucide.createIcons();
            
            // GA4: ä»®æƒ³ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
            if (typeof gtag === 'function') {
                gtag('event', 'screen_view', {
                    'screen_name': apps[appName].title,
                    'app_name': 'LLDB'
                });
            }
        }

        // å…±é€šUIåˆ¶å¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        function toggleNoren() {
            const menu = document.getElementById('noren-menu');
            const overlay = document.getElementById('noren-overlay');
            const flower = document.querySelector('.flower-icon');

            if(menu.classList.contains('open')) {
                // Close
                menu.classList.remove('open'); 
                overlay.classList.remove('open');
                flower.classList.remove('rotate'); // å›è»¢ãƒªã‚»ãƒƒãƒˆ
                setTimeout(() => { 
                    menu.style.visibility='hidden'; 
                    overlay.style.display='none'; 
                }, 400); // transitionæ™‚é–“ã¨åˆã‚ã›ã‚‹
            } else {
                // Open
                menu.style.visibility='visible'; 
                overlay.style.display='block';
                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚¯ãƒ©ã‚¹ä»˜ä¸ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç™ºç«
                setTimeout(() => { 
                    menu.classList.add('open'); 
                    overlay.classList.add('open');
                    flower.classList.add('rotate'); // å›è»¢ï¼
                }, 10);
            }
        }

        function openAboutModal() {
            toggleNoren();
            setTimeout(() => {
                const modal = document.getElementById('about-modal');
                modal.classList.add('open');
                
                // â˜…è¿½åŠ : åˆå›ã®ã¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‡¦ç†
                if (!isUpdateHistoryLoaded) {
                    loadUpdateHistory();
                }
            }, 300);
        }

        // â˜…è¿½åŠ : æ›´æ–°å±¥æ­´ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦æç”»ã™ã‚‹é–¢æ•°
        function loadUpdateHistory() {
            const container = document.getElementById('update-history-content');
            
            fetch(`${GAS_API_URL}?action=getUpdateHistory`)
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'success' && data.data.length > 0) {
                        const html = data.data.map(item => `
                            <div class="history-item">
                                <span class="history-date">
                                    ${item.date}
                                    <br><span style="font-size:10px; opacity:0.6;">${item.version}</span>
                                </span>
                                <span class="history-content">${item.content}</span>
                            </div>
                        `).join('');
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = '<div class="text-center py-4 text-gray-400 text-xs">æ›´æ–°å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                    }
                    isUpdateHistoryLoaded = true;
                })
                .catch(err => {
                    console.error(err);
                    container.innerHTML = '<div class="text-center py-4 text-gray-400 text-xs">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
                });
        }

        function closeAboutModal() {
            const modal = document.getElementById('about-modal');
            modal.classList.remove('open');
        }

        // â˜…è¿½åŠ æ©Ÿèƒ½: ã‚»ãƒˆãƒªæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã¸ã®é·ç§»å‡¦ç†
        function openSetlistForm() {
            // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ç¢ºèª
            if (confirm('ã‚»ãƒˆãƒªæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã«ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ')) {
                // æš–ç°¾ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
                toggleNoren();
                // å¤–éƒ¨ã‚µã‚¤ãƒˆã¸é·ç§»
                window.location.href = 'https://nokidochibi.github.io/LLDB_SetoriForm/';
            }
        }

// å¼·åˆ¶å†èµ·å‹•æ©Ÿèƒ½
        function forceReloadApp() {
          if (!confirm('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã—ã¦ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆè¡¨ç¤ºãŒãŠã‹ã—ã„æ™‚ãªã©ã«ãŠä½¿ã„ãã ã•ã„ï¼‰')) return;
          
          toggleNoren(); // æš–ç°¾ã‚’é–‰ã˜ã‚‹
          localStorage.clear(); // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤
    
          setTimeout(() => {
            window.location.reload(); // ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ -> é•·ã„ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç™ºå‹•
          }, 300);
        }
        // --- è¿½åŠ æ©Ÿèƒ½: ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ãƒƒãƒ—ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒˆãƒƒãƒ— ---
        document.addEventListener('DOMContentLoaded', () => {
            // â˜…é †åºå¤‰æ›´: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’æœ€å„ªå…ˆã«å®Ÿè¡Œ
            // ã“ã‚Œã«ã‚ˆã‚Šã€iframeã®èª­ã¿è¾¼ã¿é–‹å§‹å‰ã«ç¢ºå®Ÿã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹ã‚’æ•´ãˆã¾ã™
            const savedVer = localStorage.getItem('lldb_version');
            if (savedVer !== APP_VERSION) {
                localStorage.clear();
                localStorage.setItem('lldb_version', APP_VERSION);
                console.log(`Version updated to ${APP_VERSION}. Cache cleared.`);
            }

            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã®ä¸€æ‹¬åæ˜ å‡¦ç†
            document.querySelectorAll('iframe').forEach(iframe => {
                const currentSrc = iframe.getAttribute('src');
                const separator = currentSrc.includes('?') ? '&' : '?';
                iframe.setAttribute('src', `${currentSrc}${separator}v=${APP_VERSION}`);
            });
            
            const aboutVerEl = document.getElementById('about-version-display');
            if(aboutVerEl) aboutVerEl.textContent = aboutVersion;

            lucide.createIcons();
            
            // â–¼â–¼â–¼ ã“ã“ã‚’ä¿®æ­£ã—ã¾ã—ãŸ â–¼â–¼â–¼
            // URLãƒãƒƒã‚·ãƒ¥(#)ã‚’è¦‹ã¦åˆæœŸã‚¢ãƒ—ãƒªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‡¦ç†
            const hash = window.location.hash;

            if (hash === '#song') {
                switchApp('songHelper');
            } else if (hash === '#trends') {
                switchApp('trends');
            } else if (hash === '#history') {
                switchApp('history');
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ Live
                switchApp('live');
            }

            const header = document.getElementById('main-app-header');
            if(header) {
                header.addEventListener('click', (e) => {
                    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³(ğŸŒ¸)ã®ã‚¯ãƒªãƒƒã‚¯ã¯é™¤å¤–
                    if (e.target.closest('#header-menu-btn')) return;

                    const activeScreen = document.querySelector('.app-screen.active');
                    if (!activeScreen) return;

                    // 1. Hubè‡ªä½“ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    activeScreen.scrollTo({ top: 0, behavior: 'smooth' });

                    // 2. iframeå†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    const iframe = activeScreen.querySelector('iframe');
                    if (iframe && iframe.contentWindow) {
                        try {
                            const doc = iframe.contentDocument || iframe.contentWindow.document;
                            
                            // æ¨™æº–çš„ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦/ãƒœãƒ‡ã‚£ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                            iframe.contentWindow.scrollTo({ top: 0, behavior: 'smooth' });
                            doc.body.scrollTo({ top: 0, behavior: 'smooth' });
                            doc.documentElement.scrollTo({ top: 0, behavior: 'smooth' });

                            // LLDB Liveç”¨ (.mobile-frame)
                            const mobileFrame = doc.querySelector('.mobile-frame');
                            if (mobileFrame) mobileFrame.scrollTo({ top: 0, behavior: 'smooth' });

                            // LLDB Song Helperç”¨ (è¡¨ç¤ºä¸­ã®ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ)
                            const chatContainers = doc.querySelectorAll('main[id^="chat-container-"]');
                            chatContainers.forEach(el => {
                                // hiddenã‚¯ãƒ©ã‚¹ãŒãªã„(=è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹)ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                                if (!el.classList.contains('hidden')) {
                                    el.scrollTo({ top: 0, behavior: 'smooth' });
                                }
                            });

                        } catch(err) {
                            console.log("Scroll interaction failed (likely cross-origin restriction if deployed differently):", err);
                        }
                    }
                });
            }
        });
    // å­iframeã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¾…ã¡å—ã‘ã€Liveã‚¢ãƒ—ãƒªã¸æ©‹æ¸¡ã—ã™ã‚‹
    window.addEventListener('message', (event) => {
      if (event.data.type === 'requestLiveSearch') {
        // 1. ã¾ãšè¦ªå´ã§ã‚¢ãƒ—ãƒªã‚’Liveã«åˆ‡ã‚Šæ›¿ãˆã‚‹
        switchApp('live'); 
        
        // 2. Liveã‚¢ãƒ—ãƒªã®iframeã¸æ¤œç´¢æŒ‡ç¤ºã‚’è»¢é€ã™ã‚‹
        const liveIframe = document.querySelector('#app-live iframe');
        if (liveIframe && liveIframe.contentWindow) {
          // åˆ‡ã‚Šæ›¿ãˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ã‚’è€ƒæ…®ã—ã€100mså¾…ã£ã¦ã‹ã‚‰é€ä¿¡
          setTimeout(() => {
            liveIframe.contentWindow.postMessage({
              type: 'execLiveSearch',
              tourName: event.data.tourName
            }, '*');
          }, 100);
        }
      }
    });
    </script>

</body>
</html>
