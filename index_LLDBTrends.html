<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LLDB Trends</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0D09G3X4F1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // iframeå†…ã§ã®é‡è¤‡è¨ˆæ¸¬ã‚’é˜²ããŸã‚ã€è‡ªå‹•PVé€ä¿¡ã¯OFFã«ã—ã€å¿…è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ã¿æ‰‹å‹•ã§é€ã‚‹è¨­å®š
      gtag('config', 'G-0D09G3X4F1', { 'send_page_view': false });
    </script>
    
    <!-- Chart.js & Icons -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Zoom Plugin Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Tailwind (Utilityç”¨) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. Base & Theme Colors (Navy Theme)
           ========================================= */
        :root {
            --bg-color: #F8F9FA;       /* New Background Color (Off-White) */
            --header-bg: #F8F9FA;
            --accent-color: #1D3557;   /* New Theme Color (Navy) */
            --accent-light: #e0e7ff;   /* Light Indigo for backgrounds */
            --bar-color: #1D3557;
            --text-main: #334155;
            /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®é«˜ã•ã‚’85pxã«çµ±ä¸€ */
            --nav-height: 85px;        
            --sticky-offset: 0px;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            /* ãƒ•ãƒƒã‚¿ãƒ¼ã®é«˜ã• + Safe Area åˆ†ã®ä½™ç™½ */
            padding-bottom: calc(var(--nav-height) + 20px + env(safe-area-inset-bottom));
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            font-size: 16px; /* Base font size */
        }

        /* =========================================
           2. Layout & Table
           ========================================= */
        
        /* å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ï¼‹ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼‰ - ã™ã‚Šã‚¬ãƒ©ã‚¹åŒ– */
        .sticky-header-area {
            position: sticky;
            top: 0;
            z-index: 50;
            
            /* ã™ã‚Šã‚¬ãƒ©ã‚¹é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ */
            background-color: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(0,0,0,0.05); /* å¢ƒç•Œç·š */
            box-shadow: none; /* å½±ã‚’å‰Šé™¤ */

            padding-bottom: 5px;
            padding-top: 10px;
        }

        .subtitle {
            text-align: left;
            font-size: 0.75em;
            color: #94a3b8;
            margin: 5px 0 5px 15px;
            display: block;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³ */
        .filter-controls {
            text-align: center;
            margin: 0 10px;
            padding: 10px;
            background-color: #fff; /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã¯ç™½ã®ã¾ã¾ */
            border-radius: 12px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .filter-option {
            display: inline-block;
            padding: 6px 14px;
            border: 1px solid var(--accent-color);
            border-radius: 20px;
            background-color: white;
            color: var(--accent-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85em;
        }
        .filter-option.selected {
            background-color: var(--accent-color);
            color: white;
            box-shadow: 0 2px 4px rgba(29, 53, 87, 0.3);
        }
        .category-checkbox-hidden { display: none; }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ */
        .table-container {
            position: relative;
            margin: 0 5px;
            margin-top: 25px; /* æ›´æ–°æ—¥æ™‚è¡¨ç¤ºç”¨ã«å°‘ã—åºƒã’ã‚‹ */
            box-sizing: border-box;
        }
        
        /* æ›´æ–°æ—¥æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .update-time {
            position: absolute;
            top: -22px;
            right: 8px;
            font-size: 0.7em;
            color: #64748b;
            z-index: 2;
            font-family: monospace;
            background-color: rgba(248, 249, 250, 0.8);
            padding: 0 4px;
            border-radius: 4px;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--card-shadow);
            background-color: #fff;
            box-sizing: border-box;
            table-layout: fixed;
            border-radius: 16px;
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        thead {
            z-index: 40;
            background-color: transparent; 
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ - ã™ã‚Šã‚¬ãƒ©ã‚¹åŒ– */
        th {
            background-color: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            
            color: var(--text-main);
            font-weight: bold;
            cursor: pointer;
            text-align: center !important; /* å¼·åˆ¶çš„ã«ä¸­å¤®æƒãˆ */
            line-height: 1.3;
            padding: 12px 2px;
            
            border-bottom: 2px solid rgba(29, 53, 87, 0.15); 
            
            position: sticky;
            top: var(--sticky-offset);
            z-index: 40;
        }
        th small { font-size: 0.85em; opacity: 0.8; font-weight: normal; display: block; }
        
        th:first-child { border-top-left-radius: 12px; }
        th:last-child { border-top-right-radius: 12px; }

        td {
            padding: 10px 4px;
            border-bottom: 1px solid #f1f5f9;
            word-break: break-word;
            white-space: normal;
            vertical-align: middle;
            overflow: hidden;
            text-overflow: ellipsis;
            background-color: white;
        }

        tr:nth-child(even) td { background-color: #fcfcfc; }
        tr:last-child td:first-child { border-bottom-left-radius: 12px; }
        tr:last-child td:last-child { border-bottom-right-radius: 12px; }

        /* ã‚½ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ */
        .sortable th::after {
            content: ''; display: inline-block; vertical-align: middle; margin-left: 2px;
            width: 0; height: 0;
            border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 4px solid #cbd5e1;
        }
        .sortable th.asc::after {
            border-bottom: 4px solid var(--accent-color); border-top: none;
        }
        .sortable th.desc::after {
            border-top: 4px solid var(--accent-color); border-bottom: none;
        }

        /* =========================================
           â˜… åˆ—å¹…è¨­å®š (User's Favorite Layout)
           ========================================= */
        
        /* åŸºæœ¬è¨­å®šï¼š1åˆ—ç›®ã¯æœ€ä½å¹…ã‚’ç¢ºä¿ */
        th:nth-child(1), td:nth-child(1) { white-space: nowrap; min-width: 36px; }

        /* PC (>= 1025px) - å¢ƒç•Œã‚’å¤‰æ›´ */
        @media (min-width: 1025px) {
            th { font-size: 0.9em; }
            td { font-size: 1em; }

            th:nth-child(1), td:nth-child(1) { width: 8%; text-align: center; font-weight: bold; color: #94a3b8; }
            th:nth-child(2), td:nth-child(2) { width: 39.5%; text-align: left; padding-right: 15px; }
            th:nth-child(3), td:nth-child(3) { width: 15%; text-align: right; font-weight: bold; padding: 0 10px; }
            th:nth-child(4), td:nth-child(4) { width: 12.5%; text-align: center; }
            th:nth-child(5), td:nth-child(5) { width: 12.5%; text-align: right; }
            th:nth-child(6), td:nth-child(6) { width: 12.5%; text-align: right; }
        }

        /* Tablet & Mobile Landscape (max 1024px) - ç¯„å›²ã‚’åºƒã’ã¦å¤§å‹ã‚¹ãƒãƒ›æ¨ªå‘ãã«å¯¾å¿œ */
        @media (max-width: 1024px) {
            .table-container { margin: 25px 2px 0 2px; }
            th { font-size: 0.8em; padding: 8px 1px; }
            td { font-size: 0.9em; }
            
            /* # 6% (5%ã ã¨å³ã—ã„ã®ã§å¾®å¢—+min-widthç¢ºä¿) */
            th:nth-child(1), td:nth-child(1) { 
                width: 6%; 
                min-width: 40px; /* 3æ¡ç¢ºä¿ç”¨ */
                text-align: center; 
                font-weight: bold; 
                color: #94a3b8;
                text-overflow: clip; /* çœç•¥è¨˜å·å›é¿ */
            }
            /* ã‚¿ã‚¤ãƒˆãƒ« 34% (35%ã‹ã‚‰å¾®èª¿æ•´) */
            th:nth-child(2), td:nth-child(2) { 
                width: 34%; 
                text-align: left; 
                padding-right: 4px; 
                line-height: 1.4; 
            }
            /* è¦–è´å›æ•° 30% */
            th:nth-child(3), td:nth-child(3) { 
                width: 30%; 
                text-align: right; 
                font-weight: bold; 
                padding: 0 4px; 
                white-space: nowrap; 
            }
            /* å…¬é–‹æ—¥ 10% */
            th:nth-child(4), td:nth-child(4) { width: 10%; text-align: center; }
            /* å¹³å‡/æ—¥ï¼ˆå…¨ï¼‰ 10% */
            th:nth-child(5), td:nth-child(5) { width: 10%; text-align: right; padding-right: 2px; }
            /* å¹³å‡/æ—¥ï¼ˆ7æ—¥ï¼‰ 10% */
            th:nth-child(6), td:nth-child(6) { width: 10%; text-align: right; padding-right: 2px; }
        }

        /* Mobile Portrait (max 480px) */
        @media (max-width: 480px) {
            /* ãƒ™ãƒ¼ã‚¹ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’çµ±ä¸€ */
            th { font-size: 11px; padding: 12px 1px; }
            td { font-size: 12px; padding: 8px 1px; }

            /* â˜… 3æ¡å¯¾å¿œï¼šå¹…ã‚’åºƒã’ã¦ã€çœç•¥è¨˜å·(...)ã‚’å¼·åˆ¶ç„¡åŠ¹åŒ– */
            th:nth-child(1), td:nth-child(1) { 
                width: 18%; /* ä½™è£•ã‚’æŒã£ã¦åºƒã’ã‚‹ */
                text-align: center; 
                font-weight: bold; 
                color: #94a3b8; 
                font-size: 11px; 
                text-overflow: clip; /* ...ã‚’è¡¨ç¤ºã•ã›ãªã„ */
            }
            
            /* ã‚¿ã‚¤ãƒˆãƒ«åˆ—ï¼šå¹…ã‚’èª¿æ•´ */
            th:nth-child(2), td:nth-child(2) { 
                width: 26%; /* ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ */
                font-size: 13px; /* ã‚¿ã‚¤ãƒˆãƒ«ã¯èª­ã¿ã‚„ã™ãå°‘ã—å¤§ãã */
                line-height: 1.4;
            }
            
            /* è¦–è´å›æ•°åˆ— */
            th:nth-child(3), td:nth-child(3) { 
                width: 19%; 
                font-weight: bold;
            }
            
            /* å…¬é–‹æ—¥åˆ— */
            th:nth-child(4), td:nth-child(4) { 
                width: 13%; 
                font-size: 11px; /* æ—¥ä»˜ã¯å°ã•ã‚ã§OK */
            }
            
            /* å¹³å‡/æ—¥åˆ— - ã‚¹ãƒãƒ›ã§ã¯ä¸­å¤®æƒãˆã« */
            th:nth-child(5), td:nth-child(5) { width: 12%; text-align: center; }
            
            /* å¹³å‡/7æ—¥åˆ— - ã‚¹ãƒãƒ›ã§ã¯ä¸­å¤®æƒãˆã« */
            th:nth-child(6), td:nth-child(6) { width: 12%; text-align: center; }
            
            /* ã‚¹ãƒãƒ›ã§ã¯çµµæ–‡å­—ã¨æ•°å€¤ã‚’ä¸­å¤®æƒãˆã«ã™ã‚‹ */
            .emoji-number-container {
                align-items: center !important;
            }
        }

        /* ã‚»ãƒ«å†…è£…é£¾ */
        a { color: var(--text-main); text-decoration: none; display: block; }
        /* display: block ã‹ã‚‰ display: inline ã«å¤‰æ›´ã—ã€æ”¹è¡Œã•ã‚Œãªã„ã‚ˆã†ã«ä¿®æ­£ */
        a small { color: #64748b; font-size: 0.85em; display: inline; }
        
        .views-number {
            display: block;
            color: var(--accent-color);
            cursor: pointer;
            text-decoration: underline;
            text-decoration-color: rgba(29, 53, 87, 0.3);
            font-weight: bold;
            font-size: 1.1em; /* â˜…ã“ã“ã‚’è¿½åŠ  (ã‚µã‚¤ã‚ºã‚’1.1å€ã«) */
        }
        .views-graph-container {
            width: 100%; height: 4px; background-color: #f1f5f9; border-radius: 2px; margin-top: 3px; overflow: hidden;
        }
        .views-graph-bar {
            height: 100%; background-color: var(--bar-color); width: 0; transition: width 0.5s ease-out;
        }
        .emoji-number-container {
            display: flex; flex-direction: column; align-items: flex-end; line-height: 1.1;
        }
        .emoji { font-size: 1.1em; margin-bottom: 0px; line-height: 1; }
        .number-value { display: block; }

        /* â˜… ã‚«ãƒ†ã‚´ãƒªã‚¿ã‚°ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .video-tag {
            display: inline-block;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            color: #fff;
            margin-right: 4px;
            margin-bottom: 2px;
            vertical-align: text-bottom;
            white-space: nowrap;
            line-height: 1.2;
        }
        .tag-mv { background-color: #e11d48; } /* Rose-600 */
        .tag-live { background-color: #0284c7; } /* Sky-600 */
        .tag-ny { background-color: #d97706; } /* Amber-600 */
        .tag-other { background-color: #64748b; } /* Slate-500 - å¾©æ´» */

        /* =========================================
           3. UI Components (Modal, Footer, Tabs)
           ========================================= */
        
        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ (ã™ã‚Šã‚¬ãƒ©ã‚¹åŒ–) */
        nav {
            position: fixed !important;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex !important;
            border-top: 1px solid #e5e7eb;
            z-index: 50;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            height: calc(var(--nav-height) + env(safe-area-inset-bottom));
            padding-bottom: env(safe-area-inset-bottom);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.02);
        }
        nav > div {
            display: flex;
            width: 100%;
            justify-content: space-between;
            height: 100%;
        }
        
        /* ãƒŠãƒ“ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ */
        .nav-item {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; 
            justify-content: flex-start; 
            padding-top: 12px;
            gap: 4px; 
            color: #94a3b8; 
            background-color: transparent;
            padding-bottom: 0;
            cursor: pointer; 
            transition: all 0.2s;
            position: relative;
            height: 100%;
        }
        
        .nav-item.active {
            color: var(--accent-color);
            background-color: transparent;
        }
        .nav-item.active svg {
            color: var(--accent-color);
            stroke-width: 2.5px;
        }
        
        .tab-content { display: none; padding-bottom: 20px; }
        .tab-content.active { display: block; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px);
            padding-top: 60px;
            align-items: center; justify-content: center;
        }
        .modal.open { display: flex; }
        .modal-content {
            background-color: #fff; margin: auto; padding: 20px;
            border: 1px solid #e2e8f0; width: 90%; max-width: 600px;
            border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .close {
            position: absolute; top: 10px; right: 15px;
            color: #94a3b8; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .graph-title {
            text-align: center; font-size: 1.1em; color: var(--text-main);
            margin-bottom: 20px; font-weight: bold; padding-right: 20px;
        }
        #loading, #error { text-align: center; padding: 40px; color: #64748b; font-size: 0.9em; }
        #error { color: #ef4444; }

        .follower-card {
            background: white; border-radius: 16px; padding: 20px;
            margin: 16px 10px; box-shadow: var(--card-shadow);
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid var(--accent-color);
            border-radius: 50%; width: 24px; height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Tab 1: ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
    <div id="tab-views" class="tab-content active">
        
        <!-- å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
        <div id="stickyHeader" class="sticky-header-area">
            <!-- Filter -->
            <div class="filter-controls">
                <span class="filter-option" data-category="isMV" data-checkbox-id="filterMV">MV</span>
                <input type="checkbox" class="category-checkbox-hidden" id="filterMV" data-category="isMV" checked>
                
                <span class="filter-option" data-category="isFullOther" data-checkbox-id="filterFullOther">Live</span>
                <input type="checkbox" class="category-checkbox-hidden" id="filterFullOther" data-category="isFullOther" checked>
                
                <span class="filter-option" data-category="isNYMovie" data-checkbox-id="filterNYMovie">New Year</span>
                <input type="checkbox" class="category-checkbox-hidden" id="filterNYMovie" data-category="isNYMovie" checked>
                
                <span class="filter-option" data-category="isOther" data-checkbox-id="filterOther">ä»–(ã‚·ãƒ§ãƒ¼ãƒˆç­‰)</span>
                <input type="checkbox" class="category-checkbox-hidden" id="filterOther" data-category="isOther" checked>
            </div>
        </div>

        <!-- å·¦å¯„ã› (å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰å‡ºã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§æµã‚Œã‚‹ã‚ˆã†ã«å¤‰æ›´) -->
        <span class="subtitle">ã€Œè¦–è´å›æ•°ã€ã¨ã‹ã‚¿ãƒƒãƒ—ã—ãŸã‚‰é †ç•ªå…¥ã‚Œæ›¿ã‚ã‚‹ã§</span>
        
        <div id="loading">
            <div class="spinner"></div>
            <div>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
        </div>
        <div id="error" style="display:none;"></div>

        <!-- Table -->
        <div class="table-container" id="tableContainer" style="display:none;">
            <!-- æ›´æ–°æ—¥æ™‚è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <span id="lastUpdateTimeDisplay" class="update-time" style="display:none;"></span>
            
            <table id="dataTable">
                <thead><tr id="tableHeader"></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Tab 2: ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ -->
    <div id="tab-followers" class="tab-content">
        <h1 style="font-size: 1.5em; padding: 20px 20px 10px; text-align: center; font-weight: bold; color: var(--text-main);">SNSãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ¨ç§»</h1>
        
        <div class="follower-card">
            <h3 class="font-bold text-red-600 flex items-center gap-2 mb-4 text-base">
                <i data-lucide="youtube" class="w-5 h-5"></i> Youtubeç™»éŒ²è€…æ•°
            </h3>
            <div style="height: 250px; position: relative;">
                <canvas id="chart-youtube"></canvas>
            </div>
        </div>

        <div class="follower-card">
            <!-- Twitter(Sky-500) ã‹ã‚‰ X(Slate-900) ã¸å¤‰æ›´ -->
            <h3 class="font-bold text-slate-900 flex items-center gap-2 mb-4 text-base">
                <!-- X Icon SVG -->
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/>
                </svg>
                Xãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°
            </h3>
            <div style="height: 250px; position: relative;">
                <canvas id="chart-twitter"></canvas>
            </div>
        </div>
        
        <!-- å·¦å¯„ã›ï¼†å·¦ãƒãƒ¼ã‚¸ãƒ³è¿½åŠ  -->
        <p class="text-left text-xs text-slate-400 mt-4 mb-4 ml-4">
            â€» YouTubeã¯1,000å˜ä½ã€‚<br>
            ã€€ Xã¯é€”ä¸­å–å¾—ã§ããªã‹ã£ãŸæœŸé–“ãŒã‚ã‚‹ã‚ˆã€‚<br>
            ã€€ æ®‹å¿µãªãŒã‚‰ã‚¤ãƒ³ã‚¹ã‚¿/TikTokã¯å–å¾—ã§ããªã‹ã£ãŸã€‚
        </p>
    </div>

    <!-- Footer Nav -->
    <nav>
        <div style="display: flex; width: 100%; height: 100%;">
            <div onclick="switchTab('views')" class="nav-item active" id="nav-views">
                <i data-lucide="trending-up" style="width:24px;height:24px"></i>
                <span class="text-[10px] font-bold">YTè¦–è´å›æ•°</span>
            </div>
            <div onclick="switchTab('followers')" class="nav-item" id="nav-followers">
                <i data-lucide="users" style="width:24px;height:24px"></i>
                <span class="text-[10px] font-bold">ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</span>
            </div>
        </div>
    </nav>

    <!-- Modal -->
    <div id="graphModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGraphModal()">&times;</span>
            <h2 id="graphTitle" class="graph-title"></h2>
            <div id="graphLoading" style="text-align:center; padding:20px; color:#64748b;">ã‚°ãƒ©ãƒ•ä½œæˆä¸­...ğŸŒ±ğŸŒ¿ğŸŒ³</div>
            <div style="position: relative; height: 300px; width:100%;">
                <canvas id="dailyViewsChart" style="display: none;"></canvas>
            </div>
            <div id="noGraphData" style="text-align:center; display: none; padding:20px; color:#94a3b8;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
        </div>
    </div>

<script>
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbzy7CNn83anQMEsvNxyK3zHMtTRtjHk6XZ-jWBNllRNxcXv41hKw-TenGoGjfpps6rLUw/exec";
    
    let videoData = [];
    let filteredVideoData = [];
    let tableHeaders = [];
    let maxTotalViews = 0;
    let currentSortColumn = 'totalViews';
    let currentSortDirection = 'desc';
    let followersDataLoaded = false;
    let dailyViewsChartInstance = null;
    let chartInstances = { youtube: null, twitter: null };

    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        fetchData();
        fetchFollowersData();
        
        const header = document.getElementById('stickyHeader');
        if(header) {
            updateStickyOffset();
            const observer = new ResizeObserver(() => updateStickyOffset());
            observer.observe(header);
            window.addEventListener('load', updateStickyOffset);
        }

        document.querySelectorAll('.filter-option').forEach(span => {
            const checkboxId = span.dataset.checkboxId;
            const checkbox = document.getElementById(checkboxId);
            if(checkbox.checked) span.classList.add('selected');
            
            span.addEventListener('click', () => {
                checkbox.checked = !checkbox.checked;
                span.classList.toggle('selected', checkbox.checked);
                
                // â˜…è¿½åŠ : ãƒ•ã‚£ãƒ«ã‚¿æ“ä½œã®è¨ˆæ¸¬
                safeTrackEvent('select_content', {
                    content_type: 'trends_filter',
                    item_id: span.dataset.category,
                    status: checkbox.checked ? 'on' : 'off'
                });

                filterAndDisplay();
                setTimeout(updateStickyOffset, 50); 
            });
        });

        window.addEventListener('click', (e) => {
            if(e.target === document.getElementById('graphModal')) closeGraphModal();
        });

        // â–¼ è¿½åŠ ã“ã“ã‹ã‚‰ï¼šãƒ†ãƒ¼ãƒ–ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ã‚’ç›£è¦–
        const tableContainer = document.getElementById('tableContainer');
        if (tableContainer) {
            tableContainer.addEventListener('click', (e) => {
                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ãŒãƒªãƒ³ã‚¯(Aã‚¿ã‚°)ã‹ã€ãã®å†…éƒ¨ã®è¦ç´ ã‹ç¢ºèª
                const link = e.target.closest('a');
                if (link && link.href && link.href.includes('youtube.com')) {
                    safeTrackEvent('select_content', {
                        content_type: 'external_video',
                        item_name: link.textContent.trim() // ãƒªãƒ³ã‚¯ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ›²åï¼‰ã‚’å–å¾—
                    });
                }
            });
        }
        // â–² è¿½åŠ ã“ã“ã¾ã§
    });

    function updateStickyOffset() {
        const header = document.getElementById('stickyHeader');
        if(header) {
            const height = header.getBoundingClientRect().height;
            document.documentElement.style.setProperty('--sticky-offset', height + 'px');
        }
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('nav-' + tabName).classList.add('active');
        
        if (tabName === 'followers') {
            if (chartInstances.youtube) chartInstances.youtube.resize();
            if (chartInstances.twitter) chartInstances.twitter.resize();
        }

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // â˜…è¿½åŠ : ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼å®šæ•°
    const DATA_CACHE_KEY = 'lldb_trends_table_cache';

    async function fetchData() {
        // 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°å³è¡¨ç¤º
        try {
            const cached = localStorage.getItem(DATA_CACHE_KEY);
            if (cached) {
                const json = JSON.parse(cached);
                processAndDisplay(json);
            }
        } catch (e) { console.warn("Cache load failed", e); }

        // 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        try {
            const res = await fetch(`${GAS_API_URL}?action=getTrendsData`);
            const json = await res.json();
            
            if (json.status === 'error') throw new Error(json.message);

            // 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
            try {
                localStorage.setItem(DATA_CACHE_KEY, JSON.stringify(json));
            } catch (e) { console.warn("Cache save failed", e); }

            // 4. æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§å†æç”»
            processAndDisplay(json);

        } catch (e) {
            document.getElementById('error').textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + e.message;
            document.getElementById('error').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
            
            // â˜…è¿½åŠ : ã‚¨ãƒ©ãƒ¼è¨ˆæ¸¬
            safeTrackEvent('exception', {
                description: e.message,
                fatal: true
            });
        }
    }

    // â˜…è¿½åŠ : ãƒ‡ãƒ¼ã‚¿æ•´å½¢ã¨è¡¨ç¤ºã®å…±é€šé–¢æ•°
    function processAndDisplay(json) {
        const adaptedData = {
            headers: [
                { text: 'YouTube<br>å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«', key: 'title', type: 'string' },
                { text: 'è¦–è´å›æ•°', key: 'totalViews', type: 'number' },
                { text: 'å…¬é–‹æ—¥', key: 'publishedDate', type: 'date' },
                { text: 'å¹³å‡/æ—¥<br><small>(å…¨æœŸé–“)</small>', key: 'avgDailyViews', type: 'number' },
                { text: 'å¹³å‡/æ—¥<br><small>(éå»7æ—¥)</small>', key: 'avgViews7Days', type: 'number' }
            ],
            data: json.data.map(item => ({
                ...item,
                totalViews: parseFloat(item.totalViews) || 0,
                avgDailyViews: parseFloat(item.avgDailyViews) || 0,
                avgViews7Days: (item.avgViews7Days === "(é›†è¨ˆä¸­)" ? item.avgViews7Days : parseFloat(item.avgViews7Days) || 0)
            })),
            maxTotalViews: json.maxTotalViews || 0,
            // APIãŒ lastUpdateTime ã‚’è¿”ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã€ã‚ã‚Œã°ã‚»ãƒƒãƒˆ
            lastUpdateTime: json.lastUpdateTime || ''
        };

        displayData(adaptedData);
    }

    function displayData(data) {
        videoData = data.data;
        tableHeaders = data.headers;
        maxTotalViews = data.maxTotalViews;

        const thead = document.getElementById('tableHeader');
        thead.innerHTML = '<th style="cursor:default; width:4%;">#</th>';
        tableHeaders.forEach(h => {
            const th = document.createElement('th');
            th.innerHTML = h.text;
            if(h.key !== 'url') {
                th.classList.add('sortable');
                th.onclick = () => {
                    const dir = (currentSortColumn === h.key && currentSortDirection === 'asc') ? 'desc' :
                                (currentSortColumn === h.key && currentSortDirection === 'desc') ? 'asc' :
                                (h.key === 'publishedDate') ? 'asc' : 'desc';
                    
                    // â˜…è¿½åŠ : ã‚½ãƒ¼ãƒˆæ“ä½œã®è¨ˆæ¸¬
                    safeTrackEvent('select_content', {
                        content_type: 'trends_sort',
                        item_id: h.key,
                        item_category: dir
                    });

                    sortTable(h.key, h.type, dir);
                };
            }
            thead.appendChild(th);
        });

        // æ›´æ–°æ—¥æ™‚ã®è¡¨ç¤ºå‡¦ç†
        const timeDisplay = document.getElementById('lastUpdateTimeDisplay');
        if(data.lastUpdateTime) {
            timeDisplay.textContent = `â€»${data.lastUpdateTime}æ›´æ–°`;
            timeDisplay.style.display = 'block';
        } else {
            timeDisplay.style.display = 'none';
        }

        document.getElementById('loading').style.display = 'none';
        document.getElementById('tableContainer').style.display = 'block';
        
        filterAndDisplay(true);
        setTimeout(updateStickyOffset, 100);
    }

    function filterAndDisplay(isInit = false) {
        // 1. ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’å–å¾—ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        const checked = Array.from(document.querySelectorAll('.category-checkbox-hidden:checked')).map(c => c.dataset.category);
        
        if (checked.length === 0) {
            filteredVideoData = [];
        } else {
            filteredVideoData = videoData.filter(v => checked.some(c => v[c] === '1' || v[c] === 1));
        }

        const h = tableHeaders.find(h => h.key === currentSortColumn);
        if(h) {
            sortTable(currentSortColumn, h.type, currentSortDirection);
        } else {
            // ä¸‡ãŒä¸€ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®äºˆå‚™å‡¦ç†
            updateTableBody(filteredVideoData);
        }
    }

    function sortTable(key, type, dir) {
        currentSortColumn = key;
        currentSortDirection = dir;
        
        document.querySelectorAll('th.sortable').forEach(th => th.classList.remove('asc', 'desc'));
        
        const ths = document.getElementById('tableHeader').children;
        for(let i=1; i<ths.length; i++) {
            if(tableHeaders[i-1].key === key) ths[i].classList.add(dir);
        }

        const sorted = [...filteredVideoData].sort((a, b) => {
            let va = a[key], vb = b[key];
            if(type === 'number') return dir === 'asc' ? (parseFloat(va)||0)-(parseFloat(vb)||0) : (parseFloat(vb)||0)-(parseFloat(va)||0);
            if(type === 'date') {
                const da = new Date(va).getTime() || (dir==='asc'?-Infinity:Infinity);
                const db = new Date(vb).getTime() || (dir==='asc'?-Infinity:Infinity);
                return dir === 'asc' ? da - db : db - da;
            }
            return dir === 'asc' ? String(va).localeCompare(String(vb)) : String(vb).localeCompare(String(va));
        });
        updateTableBody(sorted);
    }

    function updateTableBody(data) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        
        if (data.length === 0) {
            tbody.innerHTML = `<tr><td colspan="${tableHeaders.length+1}" style="text-align:center; padding:20px; color:#94a3b8;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>`;
            return;
        }

        const maxDaily = Math.max(...data.map(d => parseFloat(d.avgDailyViews)||0));
        const max7Days = Math.max(...data.map(d => parseFloat(d.avgViews7Days)||0));

        data.forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML += `<td style="text-align:center; font-weight:bold; color:#94a3b8;">${i+1}</td>`;
            
            tableHeaders.forEach(h => {
                let td = document.createElement('td');
                const val = row[h.key];
                
                if (h.key === 'title') {
                    // â˜… ã‚«ãƒ†ã‚´ãƒªã‚¿ã‚°ã®ç”Ÿæˆ & ã‚«ãƒ†ã‚´ãƒªåˆ¤å®š
                    let tagHtml = '';
                    let category = 'Other'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

                    if (row.isMV == 1) {
                        tagHtml = '<span class="video-tag tag-mv">MV</span>';
                        category = 'MV';
                    } else if (row.isFullOther == 1) {
                        tagHtml = '<span class="video-tag tag-live">LIVE</span>';
                        category = 'Live';
                    } else if (row.isNYMovie == 1) {
                        tagHtml = '<span class="video-tag tag-ny">NY</span>';
                        category = 'NY';
                    } else {
                        tagHtml = '<span class="video-tag tag-other">ä»–</span>';
                        category = 'Other';
                    }

                    // ã‚¿ã‚°ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’çµåˆ
                    td.innerHTML = tagHtml + `<a href="${row.url}" target="_blank" style="display:inline;">${formatTitle(val, category)}</a>`;

                } else if (h.key === 'totalViews') {
                    const num = parseFloat(val)||0;
                    const pct = (maxTotalViews > 0) ? (num / maxTotalViews * 100) : 0;
                    td.innerHTML = `
                        <div class="views-cell-container">
                            <span class="views-number" onclick="openGraph('${row.url}', '${row.title.replace(/'/g,"\\'")}')">${num.toLocaleString()}</span>
                            <div class="views-graph-container"><div class="views-graph-bar" style="width:${pct}%"></div></div>
                        </div>
                    `;
                } else if (h.key === 'publishedDate') {
                    const d = new Date(val);
                    td.innerHTML = !isNaN(d.getTime()) ? `<strong>${d.getFullYear()}å¹´</strong><br><small>${d.getMonth()+1}æœˆ${d.getDate()}æ—¥</small>` : '';
                    td.style.textAlign = 'center';
                } else if (h.key.includes('avg')) {
                    const num = parseFloat(val)||0;
                    let emoji = '';
                    if (h.key === 'avgDailyViews' && num === maxDaily && num > 0) emoji = 'ğŸ‘‘';
                    if (h.key === 'avgViews7Days' && num === max7Days && num > 0) emoji = 'ğŸ”¥';
                    if (val === "(é›†è¨ˆä¸­)" || (h.key === 'avgViews7Days' && num === 0)) {
                        td.innerHTML = `<span style="font-size:0.8em; color:#94a3b8;">(é›†è¨ˆä¸­)</span>`;
                    } else {
                        td.innerHTML = `<div class="emoji-number-container">${emoji ? `<div class="emoji">${emoji}</div>` : ''}<span class="number-value">${Math.round(num).toLocaleString()}</span></div>`;
                    }
                    // JSã§ã®å¼·åˆ¶å³å¯„ã›ã‚’å‰Šé™¤ã—ã€CSSã«ä»»ã›ã‚‹
                    // td.style.textAlign = 'right'; 
                }
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    }

    async function openGraph(url, title) {
        // GA4 Tracking
        safeTrackEvent('select_content', {
            content_type: 'trend_graph',
            item_name: title
        });

        document.getElementById('graphModal').classList.add('open');
        document.getElementById('graphTitle').textContent = title;
        document.getElementById('graphLoading').style.display = 'block';
        document.getElementById('dailyViewsChart').style.display = 'none';
        
        if(dailyViewsChartInstance) { dailyViewsChartInstance.destroy(); dailyViewsChartInstance = null; }

        try {
            const res = await fetch(`${GAS_API_URL}?action=getTrendGraph&url=${encodeURIComponent(url)}`);
            const json = await res.json();
            
            document.getElementById('graphLoading').style.display = 'none';
            
            if(json.status === 'success' && json.data.length > 0) {
                document.getElementById('dailyViewsChart').style.display = 'block';
                renderGraph(json.data);
            } else {
                document.getElementById('noGraphData').style.display = 'block';
            }
        } catch(e) {
            document.getElementById('graphLoading').textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
        }
    }

    function renderGraph(data) {
        const ctx = document.getElementById('dailyViewsChart').getContext('2d');
        dailyViewsChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.date.substring(5)),
                datasets: [{
                    label: 'è¦–è´å›æ•°',
                    data: data.map(d => d.views),
                    borderColor: '#1D3557',
                    backgroundColor: 'rgba(29, 53, 87, 0.1)',
                    fill: true, tension: 0.2, pointRadius: 2
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { ticks: { maxTicksLimit: 6 } } }
            }
        });
    }

    async function fetchFollowersData() {
        if (followersDataLoaded) return;
        try {
            const res = await fetch(`${GAS_API_URL}?action=getFollowersHistory`);
            const json = await res.json();
            if (json.status === 'success') {
                chartInstances.youtube = renderFollowerChart('chart-youtube', json.data, 'youtube', '#ef4444');
                // Twitterã®è‰²ã‚’é’(#0ea5e9)ã‹ã‚‰ã‚°ãƒ¬ãƒ¼(#7d8085)ã«å¤‰æ›´
                chartInstances.twitter = renderFollowerChart('chart-twitter', json.data, 'twitter', '#7d8085');
                followersDataLoaded = true;
            }
        } catch (e) { console.error(e); }
    }

    function renderFollowerChart(id, data, key, color) {
        const ctx = document.getElementById(id).getContext('2d');
        const valid = data.filter(d => d[key] !== null);
        const chartData = valid.map(d => {
            const val = Number(d[key]);
            return val === 0 ? null : val;
        });

        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: valid.map(d => d.date),
                datasets: [{
                    data: chartData,
                    borderColor: color, 
                    backgroundColor: color+'10',
                    borderWidth: 2, 
                    fill: true, 
                    pointRadius: 2,
                    spanGaps: false
                }]
            },
            options: {
                responsive: true, 
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.y === null || context.raw === null) return 'ãƒ‡ãƒ¼ã‚¿æœªå–å¾—';
                                return context.parsed.y.toLocaleString();
                            }
                        }
                    },
                    // è¿½åŠ ï¼šã‚ºãƒ¼ãƒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®š
                    zoom: {
                        pan: {
                            enabled: true,
                            mode: 'x', // æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆãƒ‘ãƒ³ï¼‰ã®ã¿æœ‰åŠ¹
                        },
                        zoom: {
                            wheel: {
                                enabled: true,
                            },
                            pinch: {
                                enabled: true // ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒ»ã‚¢ã‚¦ãƒˆã§ã®ã‚ºãƒ¼ãƒ ã‚’æœ‰åŠ¹åŒ–
                            },
                            mode: 'x', // æ¨ªæ–¹å‘ï¼ˆæœŸé–“ï¼‰ã®ã‚ºãƒ¼ãƒ ã®ã¿æœ‰åŠ¹
                        }
                    }
                },
                scales: { x: { ticks: { maxTicksLimit: 6 } } }
            }
        });
    }

    function closeGraphModal() {
        document.getElementById('graphModal').classList.remove('open');
        document.getElementById('noGraphData').style.display = 'none';
    }

    function formatTitle(title, category) {
        if (!title) return '';
        let cleanText = title.replace(/[\r\n]+/g, ' ').replace(/[\s\u3000]+/g, ' ').trim();

        let formatted = cleanText;

        // â˜…ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šãƒ«ãƒ¼ãƒ«
        // æ—¢å­˜ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°å‰Šé™¤ãƒ­ã‚¸ãƒƒã‚¯ã¯å»ƒæ­¢

        if (category === 'MV') {
            // MVã®å ´åˆï¼š"music video","aiko-"ã‚’å‰Šé™¤
            formatted = formatted.replace(/music video/gi, '').replace(/aiko-/gi, '');
        } else if (category === 'NY') {
            // New Yearã®å ´åˆï¼š"aiko "ã‚’å‰Šé™¤ï¼ˆaikoã®å¾Œã®åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã¾ã§å«ã‚ã¦å‰Šé™¤ï¼‰
            formatted = formatted.replace(/aiko /gi, '');
        } else {
            // Liveã®å ´åˆ ã¾ãŸã¯ ä»–ã®å ´åˆ
            // "ã€"ã¾ãŸã¯"ã€Œ"ä»¥å‰ã«"aiko-"ã¾ãŸã¯"aikoâ€ã¾ãŸã¯"aiko â€ã¾ãŸã¯"aiko- "ã¾ãŸã¯"#aiko"ã¾ãŸã¯"#aiko "ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰ã€""å†…ã®è¨€è‘‰ã‚’å‰Šé™¤
            const bracketIndex = formatted.search(/[ã€ã€Œ]/);
            if (bracketIndex !== -1) {
                let pre = formatted.substring(0, bracketIndex);
                const post = formatted.substring(bracketIndex);
                
                // æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‰Šé™¤ (é•·ã„é †ãƒ»ç‰¹ç•°æ€§ãŒé«˜ã„é †ã«è¨˜è¿°)
                // cleanTextå‡¦ç†ã§ã‚¹ãƒšãƒ¼ã‚¹ã¯åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã«çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹å‰æ
                pre = pre.replace(/(?:aiko-\s|aiko\sâ€|#aiko\s|aiko-|aikoâ€|#aiko|aiko\s|aiko)/gi, '');
                
                formatted = pre + post;
            }
        }

        formatted = formatted.trim();

        // æ–‡æœ«ã®ãƒã‚¤ãƒ•ãƒ³ãªã©ãŒæ®‹ã£ãŸå ´åˆã®æƒé™¤
        if (formatted.endsWith('-') || formatted.endsWith('/')) {
             formatted = formatted.substring(0, formatted.length - 1).trim();
        }

        if (formatted.startsWith('-')) {
            formatted = formatted.substring(1).trim();
        }

        const match = formatted.match(/[ã€Œã€]/);
        if (match) {
            const idx = match.index;
            const pre = formatted.substring(0, idx).trim();
            const post = formatted.substring(idx);
            const fmtPost = post.replace(/([ã€Œã€][^ã€ã€]+[ã€ã€])/g, '<strong>$1</strong>');
            
            if (pre) {
                // å¸¸ã«æ”¹è¡Œã›ãšã‚¹ãƒšãƒ¼ã‚¹ã§ç¹‹ãã‚ˆã†ã«å¤‰æ›´
                return `<small>${pre}</small> ${fmtPost}`;
            } else {
                return fmtPost;
            }
        }
        return `<small>${formatted}</small>`;
    }

    // GA4é€ä¿¡ç”¨ã®å®‰å…¨ãªãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°
    function safeTrackEvent(eventName, params) {
        try {
            if (typeof gtag === 'function') {
                gtag('event', eventName, params);
            }
        } catch (e) {
            console.warn('GA4 Tracking Error:', e);
        }
    }
</script>
</body>
</html>
