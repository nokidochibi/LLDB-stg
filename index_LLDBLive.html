<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LLDB Live</title>
<meta name="theme-color" content="#FF6B6B">

<!-- Google Analytics / GTM -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0D09G3X4F1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  // iframeå†…ã§ã®é‡è¤‡è¨ˆæ¸¬ã‚’é˜²ããŸã‚ã€è‡ªå‹•PVé€ä¿¡ã¯OFF
  gtag('config', 'G-0D09G3X4F1', { 'send_page_view': false });
</script>

<!-- Libraries -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

<style>
/* =========================================
   Theme Configuration (CSS Variables)
   ========================================= */
:root {
  /* Color Palette */
  --color-pop:   #FF6B6B; /* Pop (Red) */
  --color-rock:  #54A0FF; /* Rock (Blue) */
  --color-aloha: #FFC048; /* Aloha (Yellow/Orange) */
  --color-event: #B2BEC3; /* Event (Gray) */
  
  --aiko-pink:   #FF69B4;
  --aiko-red:    var(--color-pop); /* Main Theme Color */
  
  /* Layout & Design */
  --aiko-bg:     #F8F9FA;
  --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
  --nav-height:  85px;
  --accent-light: #fef2f2;
}

/* =========================================
   Utility Classes for JS Dynamic Styling
   ========================================= */
.text-pop   { color: var(--color-pop) !important; }
.text-rock  { color: var(--color-rock) !important; }
.text-aloha { color: var(--color-aloha) !important; }
.text-event { color: var(--color-event) !important; }

.bg-pop     { background-color: var(--color-pop) !important; }
.bg-rock    { background-color: var(--color-rock) !important; }
.bg-aloha   { background-color: var(--color-aloha) !important; }
.bg-event   { background-color: var(--color-event) !important; }

.text-aiko-pink { color: var(--aiko-pink); }
.text-aiko-red  { color: var(--aiko-red); }

/* =========================================
   Base Styles
   ========================================= */
* { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }

html { height: 100%; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
  background-color: var(--aiko-bg);
  color: #334155;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100%;
  margin: 0;
  touch-action: pan-y pinch-zoom;
  user-select: none;
  -webkit-user-select: none;
  overflow: hidden;
}

/* Mobile Frame & Scroll */
.mobile-frame { 
  width: 100%; 
  max-width: 100%; 
  height: 100%; 
  background-color: #F8F9FA; 
  position: relative; 
  overflow-y: auto; 
  overflow-x: hidden; 
  -webkit-overflow-scrolling: touch; 
  padding-bottom: calc(var(--nav-height) + 20px + env(safe-area-inset-bottom));
}

/* Hide Scrollbar for Heatmap */
.no-scrollbar::-webkit-scrollbar { display: none; }
.no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

/* Hide Scrollbar for Heatmap */
.no-scrollbar::-webkit-scrollbar { display: none; }
.no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

/* Detail View Modifications */
body.detail-view nav { display: none !important; }
body.detail-view .mobile-frame {
  padding-bottom: calc(20px + env(safe-area-inset-bottom)) !important;
}

@media screen and (max-device-width: 1024px) and (orientation: landscape) {
  body.landscape nav { display: none !important; }
}

/* Components */
#confetti-canvas {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 9999;
}

.card-base {
  background-color: white;
  border-radius: 16px;
  box-shadow: var(--card-shadow);
  padding: 12px;
  margin-bottom: 12px;
  border: 1px solid rgba(0,0,0,0.03);
}

/* Navigation */
nav {
  position: fixed !important; bottom: 0; left: 0; right: 0;
  display: flex !important;
  border-top: 1px solid #e5e7eb;
  z-index: 50; width: 100%;
  background-color: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  height: calc(var(--nav-height) + env(safe-area-inset-bottom));
  padding-bottom: env(safe-area-inset-bottom);
  box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.02);
}
nav > div {
  display: flex; width: 100%; justify-content: space-between; height: 100%;
}

.tab-item {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: flex-start;
  padding-top: 12px; gap: 4px;
  color: #94a3b8; cursor: pointer; transition: all 0.2s;
  background-color: transparent; height: 100%; position: relative;
}
.tab-item.active { color: var(--aiko-red); }
.tab-item.active svg { stroke-width: 2.5px; }

/* Setlist Styles */
.setlist-item {
  padding: 5px 0; margin-bottom: 0;
  background-color: transparent; border-bottom: 1px solid #f3f4f6;
  font-size: 15px; line-height: 1.5;
  display: flex; align-items: center; justify-content: space-between;
  min-height: 38px; border-left: 4px solid transparent; padding-left: 8px;
}
.setlist-item:last-child { border-bottom: none; }

.setlist-medley-title {
  border-left-color: var(--color-aloha) !important;
  background-color: #fffbeb !important;
}
.setlist-medley {
  border-left-color: var(--color-aloha) !important;
  background-color: transparent !important;
}

.setlist-encore-header {
  margin-top: 16px; margin-bottom: 6px;
  font-weight: 800; color: var(--aiko-red);
  font-size: 16px; padding: 4px 8px;
  background-color: #fef2f2;
  border-left: 4px solid var(--aiko-red);
  border-radius: 0 4px 4px 0;
}
.setlist-encore {
  border-left-color: var(--aiko-red) !important;
  background-color: transparent !important;
}

.setlist-left-content {
  display: flex; align-items: baseline; width: 60%; flex: none; padding-right: 8px;
}
.setlist-item-number {
  display: inline-block; min-width: 24px; flex-shrink: 0;
  font-weight: normal; color: #9CA3AF; font-size: 12px;
}
.setlist-item-title {
  font-weight: 600; color: #334155; overflow-wrap: break-word;
}

/* Timeline */
.timeline-container {
  flex: 1; height: 30px; display: flex; align-items: center;
  position: relative; padding-left: 8px; cursor: pointer;
}
.timeline-bar {
  width: 100%; height: 3px; background-color: #e2e8f0; border-radius: 2px; position: relative;
}
.timeline-dot {
  width: 12px; height: 12px; border-radius: 50%;
  position: absolute; top: 50%; transform: translate(-50%, -50%);
  border: 2px solid white; box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  background-color: var(--aiko-pink); z-index: 10; transition: transform 0.1s;
}
.year-tooltip {
  position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%);
  background-color: #334155; color: white;
  padding: 2px 6px; border-radius: 4px;
  font-size: 10px; font-weight: bold; white-space: nowrap;
  pointer-events: none; opacity: 0; transition: opacity 0.2s; z-index: 20;
}
.year-tooltip::after {
  content: ""; position: absolute; top: 100%; left: 50%; margin-left: -4px;
  border-width: 4px; border-style: solid; border-color: #334155 transparent transparent transparent;
}
.timeline-dot.active { transform: translate(-50%, -50%) scale(1.3); }
.timeline-dot.active .year-tooltip { opacity: 1; }

/* History Grid */
.history-grid-container {
  display: flex; flex-direction: column; width: 100%;
  border-top: 1px solid #e5e7eb; padding-bottom: 20px;
}
.history-grid-header {
  position: sticky; top: 0; 
  background-color: rgba(248, 249, 250, 0.95);
  backdrop-filter: blur(5px); z-index: 30;
  border-bottom: 1px solid #e5e7eb;
}
.history-row {
  display: grid; grid-template-columns: 48px 1fr 1fr 1fr;
  min-height: 40px; border-bottom: 1px dashed #f1f5f9; position: relative;
}
.history-row.year-start {
  border-top: 2px solid #cbd5e1; margin-top: -1px;
}
.col-date {
  font-size: 10px; font-weight: bold; color: #94a3b8;
  display: flex; flex-direction: column; justify-content: flex-start;
  align-items: center; padding-top: 6px;
  background-color: #f8fafc; border-right: 1px solid #e2e8f0; line-height: 1.2;
}
.col-date .year {
  font-size: 12px; color: #475569; font-weight: 800;
}
.col-live, .col-single, .col-album {
  position: relative; display: flex; flex-direction: column;
  justify-content: center; align-items: center; padding: 4px 2px; overflow: hidden;
}
.col-single, .col-album { border-left: 1px dashed #f1f5f9; }

/* History Table */
.history-table { width: 100%; border-collapse: separate; border-spacing: 0; }
.history-table th {
  position: sticky; top: 0;
  background-color: rgba(255, 255, 255, 0.92);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  color: #334155; border-bottom: 2px solid var(--accent-light);
  font-size: 11px; font-weight: 700; padding: 12px 2px;
  z-index: 20; white-space: nowrap; text-align: center;
}
.history-table th:first-child { border-top-left-radius: 12px; }
.history-table th:last-child { border-top-right-radius: 12px; }
.history-table td {
  padding: 10px 4px; border-bottom: 1px solid #f1f5f9;
  vertical-align: middle; font-size: 11px; height: 44px;
  word-wrap: break-word; background-color: white;
}
.history-table tr:last-child td:first-child { border-bottom-left-radius: 12px; }
.history-table tr:last-child td:last-child { border-bottom-right-radius: 12px; }
.history-table tr:nth-child(even) td { background-color: #fcfcfc; } 

.event-chip { display: inline-block; padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; margin-bottom: 3px; line-height: 1.3; border: 1px solid transparent; max-width: 100%; cursor: pointer; }
.chip-live { background-color: #fef2f2; color: #ef4444; border-color: #fecaca; }
.chip-single { background-color: #f0f9ff; color: #0284c7; border-color: #bae6fd; cursor: default; }
.chip-album { background-color: #fefce8; color: #854d0e; border-color: #fef08a; cursor: default; }

/* Interaction Helpers */
.tap-trigger { touch-action: manipulation; user-select: none; -webkit-user-select: none; }
main { padding: 12px; }
body.detail-view main { padding-top: 16px; padding-bottom: 32px; }

input, select { 
    font-size: 14px !important; padding: 10px 12px !important;
    border-radius: 12px !important; border: 1px solid #cbd5e1 !important; background-color: #fff !important; 
}
button { font-size: 13px !important; }

.clickable-item { cursor: pointer; transition: background-color 0.2s; }
.clickable-item:hover { background-color: #f8fafc; }

.action-btn {
  padding: 8px 12px; border-radius: 10px; font-size: 12px;
  font-weight: bold; cursor: pointer; border: none; white-space: nowrap; flex-shrink: 0;
}
.clear-btn { background-color: #ef4444; color: white; box-shadow: 0 2px 4px rgba(239,68,68,0.3); }
.setlist-btn { background-color: var(--color-rock); color: white; box-shadow: 0 2px 4px rgba(0,191,255,0.3); }

/* Venue Tabs */
.venue-tabs { 
    display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 16px; gap: 0; 
    position: sticky; top: 0px; background: #F8F9FA; z-index: 40; padding-top: 8px;
}
.venue-tab { 
    flex: 1; padding: 10px; text-align: center; cursor: pointer;
    font-weight: bold; font-size: 13px; color: #94a3b8;
    border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; 
}
.venue-tab.active { color: var(--aiko-red); border-bottom-color: var(--aiko-red); }

/* Toggle Switch */
.toggle-checkbox { position: absolute; opacity: 0; width: 0; height: 0; }
.toggle-label {
  width: 40px; height: 22px; background-color: #e2e8f0; border-radius: 9999px;
  position: relative; cursor: pointer; transition: background-color 0.3s; display: block;
}
.toggle-label:before {
  content: ''; position: absolute; top: 2px; left: 2px;
  width: 18px; height: 18px; background-color: white; border-radius: 50%;
  transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.toggle-checkbox:checked + .toggle-label { background-color: var(--aiko-red); }
.toggle-checkbox:checked + .toggle-label:before { transform: translateX(18px); }

/* Buttons & Icons */
.back-button-circle {
  width: 44px; height: 44px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.9);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center;
  cursor: pointer; position: fixed; top: 16px; left: 16px; z-index: 1001; backdrop-filter: blur(4px); border: 1px solid #f1f5f9;
}
.back-button-circle svg { width: 22px; height: 22px; stroke: var(--aiko-red); stroke-width: 2.5; }

/* Modals */
.modal-overlay { 
    position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.6); z-index: 2000; 
    display: flex; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(2px); 
}
.modal-content { 
    background: white; border-radius: 16px; padding: 20px; width: 100%; max-width: 400px;
    max-height: 80vh; overflow-y: auto; position: relative;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); 
}
.modal-close { 
    position: absolute; top: 12px; right: 12px; width: 28px; height: 28px;
    background: #f1f5f9; border-radius: 50%; display: flex; align-items: center;
    justify-content: center; font-size: 18px; color: #64748b; cursor: pointer; 
}

/* Rankings & Lists */
.rank-number { display: inline-block; min-width: 28px; text-align: right; margin-right: 10px; flex-shrink: 0; font-size: 16px; font-weight: 800; font-style: italic; }
.song-title, .venue-name { flex: 1; word-break: break-word; font-size: 16px; font-weight: 700; line-height: 1.4; }
.song-count { white-space: nowrap; flex-shrink: 0; font-size: 15px; font-weight: bold; color: #64748b; }
.song-count span { font-size: 10px; font-weight: normal; margin-left: 2px; }

/* Live Cards & Labels */
.live-card { position: relative; overflow: hidden; padding-bottom: 14px; border: 1px solid rgba(0,0,0,0.03); }
.live-card-label {
  position: absolute; top: 16px; right: -42px; transform: rotate(45deg);
  background-color: var(--aiko-red); color: white; padding: 3px 0; width: 140px;
  text-align: center; font-size: 11px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 1;
}
/* Updated Colors with CSS Variables */
.live-card-label.pop   { background-color: var(--color-pop); }
.live-card-label.rock  { background-color: var(--color-rock); }
.live-card-label.aloha { background-color: var(--color-aloha); color: #fff; } /* Aloha text white for better contrast with orange */
.live-card-label.other { background-color: var(--color-event); }

/* Animations */
.fade-out { opacity: 0; transition: opacity 0.5s ease-out; pointer-events: none; }
.spin-once { animation: spin 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.tap-highlight { animation: highlight 0.3s ease-out; }
@keyframes highlight { 0% { transform: scale(1); } 50% { transform: scale(1.05); color: var(--aiko-red); } 100% { transform: scale(1); } } 

/* Loading Placeholder */
.loading-placeholder {
    animation: pulse-bg 1.5s infinite; background-color: #f3f4f6; height: 80px;
    border-radius: 16px; margin-bottom: 12px; display: flex; align-items: center;
    justify-content: center; text-align: center; padding: 0 16px; 
    color: #cbd5e1; font-weight: bold; font-size: 14px;
}
@keyframes pulse-bg { 0% { background-color: #f3f4f6; } 50% { background-color: #e5e7eb; } 100% { background-color: #f3f4f6; } }

/* My LLDB specific styles */
.attended-badge {
  display: inline-flex; align-items: center; gap: 4px;
  background-color: #ecfccb; color: #4d7c0f; font-size: 10px; font-weight: bold;
  padding: 2px 8px; border-radius: 99px; border: 1px solid #bef264; margin-left: auto;
}
.attendance-toggle-container {
  display: flex; align-items: center; justify-content: space-between;
  background-color: #f0fdf4; border: 1px solid #bbf7d0;
  padding: 12px 16px; border-radius: 12px; margin-bottom: 12px;
}
.attendance-toggle-label { font-weight: bold; color: #166534; font-size: 14px; display: flex; align-items: center; gap: 6px; }
.user-memo-area {
  background-color: #fff; border: 1px dashed #cbd5e1; border-radius: 12px;
  padding: 12px; margin-bottom: 24px; position: relative;
}
.user-memo-area.has-content { background-color: #f8fafc; border-style: solid; }
.memo-placeholder { text-align: center; color: #94a3b8; font-size: 12px; cursor: pointer; padding: 8px; }
.memo-content { font-size: 13px; color: #334155; white-space: pre-wrap; line-height: 1.6; }
.memo-link { display: block; margin-top: 8px; font-size: 12px; color: #3b82f6; text-decoration: none; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.memo-edit-btn {
  position: absolute; top: 8px; right: 8px;
  background: #f1f5f9; color: #64748b; border-radius: 6px; 
  padding: 4px 8px; font-size: 11px; cursor: pointer; font-weight: bold;
}
.filter-toggle-row { display: flex; align-items: center; justify-content: flex-end; margin-top: 8px; }
.filter-toggle-label { font-size: 11px; font-weight: bold; color: #64748b; margin-right: 8px; }

/* Records Tab overrides */
#user-song-ranking-container .rank-number { font-size: 16px; width: 28px; text-align: right; }
#user-song-ranking-container .song-title { font-size: 16px; }
#user-song-ranking-container .song-count { font-size: 15px; }
</style>
</head>
<body>
<canvas id="confetti-canvas"></canvas>

<div id="app" class="mobile-frame bg-[#F8F9FA]">

<main id="main-content" style="opacity: 0; transition: opacity 0.5s;">
  <div id="live-detail" style="display:none"></div>

  <div id="tab-search" class="tab-content" style="display:block">
    <p class="text-gray-400 mb-1 text-xs text-right font-mono">Data updated: <span id="last-update-date">-</span></p>
    <div class="card-base bg-white border-0">
  <div class="flex gap-2 mb-2 items-center">
    <div class="relative flex-1">
        <input type="text" id="search-input" placeholder="ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢" class="w-full px-3 py-2 bg-gray-50 border-gray-200 focus:ring-2 focus:ring-red-200 focus:border-red-400 transition">
    </div>
    
    <div class="flex-1 flex items-center justify-end gap-2">
        <div class="flex items-center gap-1 cursor-pointer tap-trigger" onclick="window.parent.postMessage({type: 'openMyLLDB'}, '*')">
        <span class="text-[12px] font-bold text-gray-500">å‚æˆ¦ã—ãŸãƒ©ã‚¤ãƒ–ã®ã¿</span>
        <i data-lucide="info" class="w-3 h-3 text-gray-400"></i>
        </div>
        <div class="relative inline-block align-middle select-none shrink-0">
            <input type="checkbox" id="attended-filter-toggle" class="toggle-checkbox" />
            <label for="attended-filter-toggle" class="toggle-label" style="transform: scale(0.9); display:block;"></label>
        </div>
    </div>
  </div>

  <div class="flex flex-col gap-2 mb-2">
    <select id="tour-select" class="w-full text-gray-700 bg-gray-50 border-gray-200"><option value="">ã™ã¹ã¦ã®ãƒ©ã‚¤ãƒ–</option><option value="pop">Love Like Pop</option><option value="rock">Love Like Rock</option><option value="aloha">Love Like Aloha</option><option value="other">ãã®ä»–ã®Event</option></select>
    <div class="flex gap-2">
      <select id="year-select" class="flex-1 text-gray-700 bg-gray-50 border-gray-200"><option value="">ã™ã¹ã¦ã®å¹´</option></select>
      <select id="region-select" class="flex-1 text-gray-700 bg-gray-50 border-gray-200"><option value="">ã™ã¹ã¦ã®éƒ½é“åºœçœŒ</option></select>
    </div>
  </div>

  <div class="flex gap-2 items-center">
    <div class="flex-1">
        <input type="text" id="song-filter-input" placeholder="æ›²åã§çµã‚Šè¾¼ã¿ï¼ˆæ¥½æ›²ã‚¿ãƒ–ã‹ã‚‰é¸æŠï¼‰" class="w-full bg-gray-100 text-gray-500 border-dashed" readonly>
    </div>
    <button id="clear-all-btn" class="action-btn clear-btn">ã‚¯ãƒªã‚¢</button>
  </div>
</div>

    <div id="omikuji-trigger-area" class="my-4 py-1 tap-trigger select-none cursor-pointer text-gray-600 hover:text-gray-800 transition-colors bg-white/50 rounded-xl p-3 border border-dashed border-gray-200 text-center">
      <h3 class="font-bold text-base flex items-center justify-center gap-2">
        <span id="omikuji-icon" class="inline-block text-lg">ğŸ«</span>
        <span>
          <span id="display-count-text">è¡¨ç¤ºä¸­ã®å…¬æ¼”æ•°</span>: 
          <span id="display-count" class="text-lg text-aiko-red">0</span> / <span id="total-count">0</span>
        </span>
      </h3>
    </div>

    <div id="live-list-container" class="space-y-3">
        <div class="loading-placeholder">ä»Šæ—¥ã‚‚éƒ½åˆã‚ˆãç”Ÿãã‚‹...</div>
        <div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="loading-placeholder">å°‘ã—å¾…ã£ã¦ã¦ã­...</div>
    </div>
  </div>

  <div id="tab-song" class="tab-content" style="display:none">
    <div class="mb-5">
      <h3 class="font-bold mb-2 text-gray-700 text-base flex items-center gap-2"><i data-lucide="bar-chart-2" class="w-4 h-4 text-aiko-red"></i> å¹´åˆ¥æ¼”å¥å›æ•°</h3>
      <div class="card-base bg-white p-2">
        <canvas id="live-count-chart" style="height:220px; max-height:220px"></canvas>
      </div>
    </div>

    <div class="card-base bg-white border-0 p-4 mb-5 flex items-center justify-between overflow-hidden relative">
      <div class="flex-1">
        <h3 class="font-bold mb-3 text-gray-700 text-base flex items-center gap-2">
          <i data-lucide="ticket" class="w-4 h-4 text-aiko-red"></i> <span id="song-stats-label">å…¨ãƒ©ã‚¤ãƒ–é–‹å‚¬å›æ•°</span>: <span id="total-held-lives" class="text-lg text-aiko-red">0</span>
        </h3>
        <div id="live-category-counts" class="text-sm font-bold space-y-1"></div>
      </div>
      <div style="width: 70px; height: 70px;" class="flex-shrink-0">
        <canvas id="live-category-doughnut"></canvas>
      </div>
    </div>
    <div class="card-base bg-white border-0 mb-4">
      <div class="flex gap-2 mb-3 items-center">
        <div class="relative flex-1">
            <input type="text" id="song-search-input" placeholder="æ¥½æ›²åã§æ¤œç´¢" class="w-full px-3 bg-gray-50 border-gray-200">
        </div>
        <button id="song-clear-btn" class="action-btn clear-btn">ã‚¯ãƒªã‚¢</button>
        <button id="show-setlist-btn" class="action-btn setlist-btn" style="display: none;">å…¬æ¼”è¡¨ç¤º</button>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-gray-500 text-sm">å…¨æ¥½æ›²: <span id="total-songs" class="font-bold text-gray-800">-</span> æ›²</span>
        <div class="flex items-center gap-2">
            <span class="text-[12px] font-bold text-gray-500">ãƒ¡ãƒ‰ãƒ¬ãƒ¼è¾¼ã¿</span>
            <div class="relative inline-block align-middle select-none shrink-0">
                <input type="checkbox" name="toggle" id="medley-toggle" class="toggle-checkbox" checked/>
                <label for="medley-toggle" class="toggle-label" style="transform: scale(0.85); display:block;"></label>
            </div>
        </div>
      </div>
    </div>

    <div class="flex items-center mt-6 mb-3 px-1 gap-1">
      <h3 id="song-ranking-header" class="font-bold text-gray-700 text-[15px] flex-1 cursor-pointer select-none tap-trigger flex items-center gap-1">
        <span id="song-ranking-icon" class="inline-block">ğŸ¸</span> ãƒ©ãƒ³ã‚­ãƒ³ã‚°
      </h3>
      <div class="flex gap-1 items-center shrink-0">
        <div onclick="updateSongSort('count')" class="flex items-center gap-0.5 bg-white px-2 py-1.5 rounded-lg shadow-sm border border-gray-100 cursor-pointer active:scale-95 transition-all">
            <span class="text-[11px] font-bold text-gray-600">æ¼”å¥å›æ•°</span>
            <i id="sort-icon-count" data-lucide="chevron-down" class="w-3 h-3 text-aiko-red"></i>
        </div>
        <div onclick="updateSongSort('year')" class="flex items-center gap-0.5 bg-white px-2 py-1.5 rounded-lg shadow-sm border border-gray-100 cursor-pointer active:scale-95 transition-all">
            <span class="text-[11px] font-bold text-gray-600">(æœ€çµ‚æ¼”å¥å¹´)</span>
            <i id="sort-icon-year" data-lucide="chevrons-up-down" class="w-3 h-3 text-gray-300"></i>
        </div>
      </div>
    </div>
    
    <div id="song-ranking-container"></div>
  </div>

  <div id="tab-venue" class="tab-content" style="display:none">
    <div class="mb-5">
      <h3 class="font-bold mb-2 text-gray-700 text-base flex items-center gap-2"><i data-lucide="bar-chart" class="w-4 h-4 text-aiko-red"></i> å¹´åˆ¥é–‹å‚¬å›æ•°</h3>
      <div class="card-base bg-white p-2">
        <canvas id="venue-live-count-chart" style="height:220px; max-height:220px"></canvas>
      </div>
    </div>
    <div class="card-base bg-white border-0 mb-0 rounded-b-none pb-4">
      <div class="flex gap-2 items-center">
        <div class="relative flex-1">
            <input type="text" id="venue-search-input" placeholder="ä¼šå ´ / éƒ½é“åºœçœŒã§æ¤œç´¢" class="w-full px-3 bg-gray-50 border-gray-200">
        </div>
        <button id="venue-clear-btn" class="action-btn clear-btn">ã‚¯ãƒªã‚¢</button>
        <button id="venue-show-setlist-btn" class="action-btn setlist-btn" style="display: none;">å…¬æ¼”è¡¨ç¤º</button>
      </div>
    </div>
    <div class="venue-tabs mb-3">
      <div class="venue-tab active" data-venue-tab="venue" id="venue-tab-header">ä¼šå ´ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
      <div class="venue-tab" data-venue-tab="region" id="region-tab-header">éƒ½é“åºœçœŒãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
    </div>
    <div id="venue-ranking-container" class="mt-2"></div>
    <div id="region-ranking-container" class="mt-2" style="display:none"></div>
  </div>
    
  <div id="tab-pattern" class="tab-content" style="display:none">
    <div class="mb-5">
      <h3 class="font-bold mb-2 text-gray-700 text-base flex items-center gap-2"><i data-lucide="disc" class="w-4 h-4 text-aiko-red"></i> ã‚¢ãƒ«ãƒãƒ åˆ¥æ¼”å¥å›æ•°</h3>
      <div class="card-base bg-white p-2">
        <canvas id="album-chart" style="height:300px; max-height:300px"></canvas>
      </div>
    </div>

    <div class="mb-5"><h3 class="font-bold mb-2 text-gray-700 text-base">ğŸ¬ ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°æ›² TOP 10</h3>
    <div id="opening-songs" class="card-base bg-white p-2"></div></div>
    <div class="mb-5"><h3 class="font-bold mb-2 text-gray-700 text-base">ğŸ‘ ã‚¢ãƒ³ã‚³ãƒ¼ãƒ«æ›² TOP 10</h3>
    <div id="encore-songs" class="card-base bg-white p-2"></div></div>
    <div class="mb-5"><h3 class="font-bold mb-2 text-gray-700 text-base">ğŸ å¤§ãƒˆãƒªæ›² TOP 10</h3>
    <div id="last-songs" class="card-base bg-white p-2"></div></div>
  </div>

  <div id="tab-records" class="tab-content" style="display:none">
  <div id="records-unregistered" class="card-base bg-white text-center py-10 hidden">
    <p class="text-gray-500 text-sm">
      ã“ã®æ©Ÿèƒ½ã¯ <a href="#" onclick="window.parent.postMessage({type: 'openMyLLDB'}, '*'); return false;" class="text-aiko-red underline font-bold">My LLDB</a> ã«ç™»éŒ²ã™ã‚‹ã¨ä½¿ãˆã‚‹ã‚ˆ
    </p>
  </div>

  <div id="records-content" class="hidden">
    <div class="mb-5">
      <h3 class="font-bold mb-2 text-gray-700 text-base flex items-center gap-2"><i data-lucide="bar-chart-2" class="w-4 h-4 text-aiko-red"></i> å¹´åˆ¥å‚æˆ¦å›æ•°</h3>
      <div class="card-base bg-white p-2">
        <canvas id="user-yearly-chart" style="height:220px; max-height:220px"></canvas>
      </div>
    </div>

    <div class="card-base bg-white border-0 p-4 mb-5 flex items-center justify-between overflow-hidden relative">
      <div class="flex-1">
        <h3 class="font-bold mb-3 text-gray-700 text-base flex items-center gap-2">
          <i data-lucide="award" class="w-4 h-4 text-aiko-red"></i> <span id="user-stats-label">ã‚ãªãŸã®å‚æˆ¦å›æ•°</span>: <span id="user-total-attended" class="text-lg text-aiko-red">0</span>
        </h3>
        <div id="user-category-counts" class="text-sm font-bold space-y-1">
          </div>
      </div>
      <div style="width: 70px; height: 70px;" class="flex-shrink-0">
  <canvas id="user-category-doughnut"></canvas>
</div>
    </div>

    <div class="card-base bg-white border-0 mb-4 p-3">
            <div class="flex gap-2 mb-3">
                <input type="text" id="record-song-search" placeholder="æ¥½æ›²åã§æ¤œç´¢" class="flex-1 px-3 bg-gray-50 border-gray-200" oninput="renderUserSongRanking()">
                <button id="record-song-clear-btn" class="action-btn clear-btn">ã‚¯ãƒªã‚¢</button>
                <button id="user-show-setlist-btn" class="action-btn setlist-btn" style="display: none;">å…¬æ¼”è¡¨ç¤º</button>
            </div>
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-500 text-xs font-bold">å…¨æ¥½æ›²: <span id="user-total-songs" class="text-gray-800">0</span> æ›²</span>
                <div class="flex items-center gap-2">
                    <span class="text-[12px] font-bold text-gray-500">ãƒ¡ãƒ‰ãƒ¬ãƒ¼è¾¼ã¿</span>
                    <div class="relative inline-block align-middle select-none shrink-0">
                        <input type="checkbox" id="user-medley-toggle" class="toggle-checkbox" checked onchange="renderUserSongRanking()" />
                        <label for="user-medley-toggle" class="toggle-label" style="transform: scale(0.85); display:block;"></label>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-between items-end mb-3 px-1">
            <h3 id="user-song-ranking-header" class="font-bold text-gray-700 text-base flex items-center gap-2 cursor-pointer select-none tap-trigger"><span id="user-song-ranking-icon" class="inline-block"><i data-lucide="music-2" class="w-4 h-4 text-aiko-red"></i></span> ã‚ãªãŸãŒè´ã„ãŸæ›²</h3>
            <div class="flex gap-1 items-center shrink-0">
        <div onclick="switchUserSongSort('count')" class="flex items-center gap-0.5 bg-white px-2 py-1.5 rounded-lg shadow-sm border border-gray-100 cursor-pointer active:scale-95 transition-all">
          <span class="text-[11px] font-bold text-gray-600">è´ã„ãŸå›æ•°</span>
          <i id="user-sort-icon-count" data-lucide="chevron-down" class="w-3 h-3 text-aiko-red"></i>
        </div>
        <div onclick="switchUserSongSort('year')" class="flex items-center gap-0.5 bg-white px-2 py-1.5 rounded-lg shadow-sm border border-gray-100 cursor-pointer active:scale-95 transition-all">
          <span class="text-[11px] font-bold text-gray-600">(æœ€çµ‚å‚æˆ¦å¹´)</span>
          <i id="user-sort-icon-year" data-lucide="chevrons-up-down" class="w-3 h-3 text-gray-300"></i>
        </div>
      </div>
    </div>

    <div id="user-song-ranking-container"></div>
  </div>
</div>

</main>

<div id="loading-container" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; z-index:9000; display:flex; align-items:center; justify-content:center;">
  <div class="text-center py-20 font-bold select-none overflow-hidden" style="color: white; text-shadow: 0 0 15px white;">
    <!-- ä¿®æ­£: styleã« white-space: nowrap; ã‚’è¿½åŠ ã—ã¦æ”¹è¡Œã‚’é˜²æ­¢ -->
    <p class="m-0 transition-opacity duration-300" style="font-size:42px; line-height:1.2; white-space: nowrap;">
      <span id="loading-text-1" class="opacity-0">ç”·å­ãƒ¼!!</span> <span id="loading-text-2" class="opacity-0">å¥³å­ãƒ¼!!</span>
    </p>
    <p class="m-0 transition-opacity duration-300" style="font-size:42px; line-height:1.2;">
      <span id="loading-text-3" class="opacity-0">ãã†ã§ãªã„äººãƒ¼!!</span>
    </p>
    <!-- ä¿®æ­£: ã“ã¡ã‚‰ã‚‚ styleã« white-space: nowrap; ã‚’è¿½åŠ  -->
    <p class="m-0 transition-opacity duration-300" style="font-size:56px; line-height:1.2; margin-top:16px; white-space: nowrap;">
      <span id="loading-text-4" class="opacity-0">ãœãƒ¼</span><span id="loading-text-5" class="opacity-0">ã„ã‚“ã£...!!!</span>
    </p>
  </div>
</div>

<div id="modal-overlay" class="modal-overlay" style="display:none">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <div id="modal-body"></div>
  </div>
</div>

<div id="memo-modal" class="modal-overlay" style="display:none">
  <div class="modal-content">
    <span class="modal-close" onclick="closeMemoModal()">&times;</span>
    <h3 class="font-bold text-lg mb-4 text-gray-700">ğŸ“ å‚æˆ¦ãƒ¡ãƒ¢</h3>
    <div class="mb-6">
      <label class="block text-xs font-bold text-gray-500 mb-1">ã²ã¨ã“ã¨ãƒ¡ãƒ¢</label>
      <textarea id="memo-textarea" class="w-full p-3 border border-gray-300 rounded-lg text-sm h-40 focus:ring-2 focus:ring-aiko-red focus:border-transparent" placeholder="åº§å¸­ã€èª°ã¨è¡Œã£ãŸã‹ã€noteã‚„Xãªã©ã®ãƒªãƒ³ã‚¯ãªã©..."></textarea>
    </div>
    <div class="flex gap-2">
      <button onclick="saveMemo()" class="flex-1 bg-[#E63946] text-white py-3 rounded-xl font-bold shadow">ä¿å­˜ã™ã‚‹</button>
      <button onclick="deleteMemo()" class="flex-none bg-gray-200 text-gray-600 py-3 px-4 rounded-xl font-bold">å‰Šé™¤</button>
    </div>
  </div>
</div>

<nav>
  <div class="flex w-full">
    <a href="#" class="tab-item active" data-tab="search">
      <i data-lucide="calendar-days" style="width:24px;height:24px"></i>
      <span class="text-[10px] font-bold">å…¬æ¼”</span>
    </a>
    <a href="#" class="tab-item" data-tab="song">
      <i data-lucide="music" style="width:24px;height:24px"></i>
      <span class="text-[10px] font-bold">æ¥½æ›²</span>
    </a>
    <a href="#" class="tab-item" data-tab="venue">
      <i data-lucide="map-pin" style="width:24px;height:24px"></i>
      <span class="text-[10px] font-bold">å ´æ‰€</span>
    </a>
    <a href="#" class="tab-item" data-tab="pattern">
      <i data-lucide="bar-chart-3" style="width:24px;height:24px"></i>
      <span class="text-[10px] font-bold">å‚¾å‘</span>
    </a>
    <a href="#" class="tab-item" data-tab="records">
      <i data-lucide="award" style="width:24px;height:24px"></i>
      <span class="text-[10px] font-bold">è¨˜éŒ²</span>
    </a>
  </div>
</nav>

</div>

<!-- Main Logic -->
<script src="index_LLDBLive.js"></script>

</body>
</html>
